{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-lg-3">
        <form action="" method="post" novalidate>
            {{ form.hidden_tag() }}
            <div class="mb-3">
                {{ form.search.label(class_="form-label") }}
                {{ form.search(size=32, class_="form-control") }}
            </div>
            <div class="mb-3">
                {{ form.title.label(class_="form-label") }}
                {{ form.title(size=32, class_="form-control") }}
            </div>
            <div class="mb-3">
                {{ form.author.label(class_="form-label") }}
                {{ form.author(size=32, class_="form-control") }}
            </div>
            <div class="mb-3">
                {{ form.publisher.label(class_="form-label") }}
                {{ form.publisher(size=32, class_="form-control") }}
            </div>
            <div class="mb-3">
                {{ form.subject.label(class_="form-label") }}
                {{ form.subject(size=32, class_="form-control") }}
            </div>
            <div class="mb-3">
                {{ form.isbn.label(class_="form-label") }}
                {{ form.isbn(size=13, class_="form-control") }}
            </div>
            {{ form.submit(class_="btn btn-primary") }}
        </form>
    </div>
    <div class="col-lg-9" id='books'>

    </div>
    <script type="text/javascript">
        var local_books = []

        function create_link(book, index) {
            return `<div id="${index}"
                class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                <div class="flex-column">
                    ${book.title} <small>by ${book.author}</small>
                    <p><small>Pub date: ${book.date}</small></p>
                    <p>ISBN: ${book.isbn}</p>
                    <span class="badge bg-primary">pageCount: ${book.pages}</span>
                    <span class="badge bg-secondary">lang: ${book.language}</span>
                    <button type="button" class="btn btn-danger" onClick=remove_book(${index})>Remove</button>
                </div>
                <figure class="figure">
                    <img src="${book.frontPage}" class="img-thumbnail" width="100" height="150" alt="front page">
                </figure>
            </div>`

        }

        function generate_html() {
            books = document.getElementById('books');
            books.innerHTML = `<ul class="list-group" id="book-list"> ${local_books.map((book, index) => create_link(book, index)).join('')} </ul>`
        }

        function remove_book(index) {
            local_books.splice(index, 1)
            generate_html()
        }

        function put_books(books) {
            for (var book of books) {
                local_books.push(book)
            }
            generate_html()
        }

        put_books({{ books | safe }})
    </script>
</div>
{% endblock %}